<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>保研加分小助手</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 【前端】自定义样式 */
        * {
            box-sizing: border-box;
        }
        .hidden {
            display: none !important;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        /* 动画 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        /* 表格样式 */
        .table-container {
            overflow-x: auto;
        }
        /* 卡片悬停效果 */
        .hover-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        /* 当前用户行高亮 */
        .current-user-row {
            background-color: #eff6ff;
            font-weight: 500;
        }

        #upload-description{
            resize: none;
        }

        #review-comment{
            resize: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 【前端】Toast 通知容器 -->
    <div id="toast-container" class="fixed top-4 right-4 z-50"></div>

    <!-- 【前端】登录页面 -->
    <div id="login-page" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-900">保研加分小助手</h1>
                <p class="text-gray-600 mt-2">请登录您的账户以继续使用系统</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">用户类型</label>
                    <select id="login-role" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="student">学生</option>
                        <option value="admin">辅导员/管理员</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" id="login-username-label">学号</label>
                    <input type="text" id="login-username" placeholder="请输入学号" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">密码</label>
                    <input type="password" id="login-password" placeholder="请输入密码" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button id="login-btn" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition-colors">
                    登录
                </button>
                <div class="text-sm text-gray-500 text-center space-y-1 mt-4">
                    <p>演示账号：</p>
                    <p>学生 - 用户名: student, 密码: 123456</p>
                    <p>管理员 - 用户名: admin, 密码: 123456</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 【前端】学生端界面 -->
    <div id="student-dashboard" class="hidden">
        <!-- 顶部导航 -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-3">
                        <i data-lucide="trophy" class="h-8 w-8 text-blue-600"></i>
                        <div>
                            <h1 class="text-xl font-bold">保研加分小助手</h1>
                            <p class="text-sm text-gray-500">学生端</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <p class="text-sm font-medium" id="student-name"></p>
                            <p class="text-xs text-gray-500" id="student-id"></p>
                        </div>
                        <button id="student-logout-btn" class="flex items-center space-x-2 px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition-colors">
                            <i data-lucide="log-out" class="h-4 w-4"></i>
                            <span>退出登录</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- 统计卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">当前总分</h3>
                        <i data-lucide="trophy" class="h-4 w-4 text-yellow-600"></i>
                    </div>
                    <p class="text-2xl font-bold" id="student-total-points">0</p>
                    <p class="text-xs text-gray-500 mt-1">已通过审核的加分项</p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">待审核申请</h3>
                        <i data-lucide="file-text" class="h-4 w-4 text-blue-600"></i>
                    </div>
                    <p class="text-2xl font-bold" id="student-pending-count">0</p>
                    <p class="text-xs text-gray-500 mt-1">等待管理员审核</p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">总申请数</h3>
                        <i data-lucide="users" class="h-4 w-4 text-green-600"></i>
                    </div>
                    <p class="text-2xl font-bold" id="student-total-applications">0</p>
                    <p class="text-xs text-gray-500 mt-1">累计提交申请</p>
                </div>
            </div>

            <!-- Tab导航 -->
            <div class="mb-6">
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-8">
                        <button class="student-tab py-4 px-1 border-b-2 font-medium text-sm transition-colors border-blue-500 text-blue-600" data-tab="upload">
                            <span class="flex items-center space-x-2">
                                <i data-lucide="upload" class="h-4 w-4"></i>
                                <span>材料上传</span>
                            </span>
                        </button>
                        <button class="student-tab py-4 px-1 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="applications">
                            我的申请
                        </button>
                        <button class="student-tab py-4 px-1 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="ranking">
                            排名公示
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Tab内容区 -->
            <div id="student-tab-content">
                <!-- 材料上传页面 -->
                <div id="upload-tab" class="tab-content space-y-6">
                    <!-- 学生信息卡片 -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6">
                        <h3 class="font-bold text-lg mb-4">学生信息</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <p class="text-sm text-gray-600">姓名</p>
                                <p class="text-lg font-medium" id="upload-student-name"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">学号</p>
                                <p class="text-lg font-medium" id="upload-student-id"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">专业</p>
                                <p class="text-lg font-medium" id="upload-student-major"></p>
                            </div>
                        </div>
                    </div>

                    <!-- 四个上传分类卡片 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- 竞赛加分 -->
                        <div class="bg-white rounded-lg shadow hover-card p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="p-2 rounded-lg bg-gray-100">
                                    <i data-lucide="trophy" class="h-6 w-6 text-yellow-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg">竞赛加分</h3>
                                    <p class="text-sm text-gray-600">上传竞赛获奖证书（国家级、省级、校级等）</p>
                                </div>
                            </div>
                            <button class="upload-category-btn w-full px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center justify-center space-x-2" data-category="competition">
                                <i data-lucide="upload" class="h-4 w-4"></i>
                                <span>上传材料</span>
                            </button>
                            <p class="text-xs text-gray-500 mt-3">支持格式：PDF、JPG、PNG</p>
                        </div>

                        <!-- 论文加分 -->
                        <div class="bg-white rounded-lg shadow hover-card p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="p-2 rounded-lg bg-gray-100">
                                    <i data-lucide="file-text" class="h-6 w-6 text-blue-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg">论文加分</h3>
                                    <p class="text-sm text-gray-600">上传发表论文或会议收录证明（PDF/图片）</p>
                                </div>
                            </div>
                            <button class="upload-category-btn w-full px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center justify-center space-x-2" data-category="paper">
                                <i data-lucide="upload" class="h-4 w-4"></i>
                                <span>上传材料</span>
                            </button>
                            <p class="text-xs text-gray-500 mt-3">支持格式：PDF、JPG、PNG</p>
                        </div>

                        <!-- 专利加分 -->
                        <div class="bg-white rounded-lg shadow hover-card p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="p-2 rounded-lg bg-gray-100">
                                    <i data-lucide="lightbulb" class="h-6 w-6 text-purple-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg">专利加分</h3>
                                    <p class="text-sm text-gray-600">上传国家发明专利或实用新型专利证书</p>
                                </div>
                            </div>
                            <button class="upload-category-btn w-full px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center justify-center space-x-2" data-category="patent">
                                <i data-lucide="upload" class="h-4 w-4"></i>
                                <span>上传材料</span>
                            </button>
                            <p class="text-xs text-gray-500 mt-3">支持格式：PDF、JPG、PNG</p>
                        </div>

                        <!-- 综合表现 -->
                        <div class="bg-white rounded-lg shadow hover-card p-6">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="p-2 rounded-lg bg-gray-100">
                                    <i data-lucide="award" class="h-6 w-6 text-green-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg">综合表现</h3>
                                    <p class="text-sm text-gray-600">上传荣誉证书、志愿服务证明、学生工作证明等</p>
                                </div>
                            </div>
                            <button class="upload-category-btn w-full px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center justify-center space-x-2" data-category="comprehensive">
                                <i data-lucide="upload" class="h-4 w-4"></i>
                                <span>上传材料</span>
                            </button>
                            <p class="text-xs text-gray-500 mt-3">支持格式：PDF、JPG、PNG</p>
                        </div>
                    </div>

                    <!-- 审核进度卡片 -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="font-bold text-lg mb-2">加分项审核进度</h3>
                        <p class="text-sm text-gray-600 mb-4">已提交的申请材料审核情况</p>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span>已审核：<span class="text-green-600" id="progress-reviewed">0</span> 项</span>
                                <span>待审核：<span class="text-orange-600" id="progress-pending">0</span> 项</span>
                                <span>总计：<span class="text-blue-600" id="progress-total">0</span> 项</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-gray-500" id="progress-text">暂无申请记录，请点击上方卡片上传材料</p>
                        </div>
                    </div>
                </div>

                <!-- 我的申请页面 -->
                <div id="applications-tab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <h3 class="font-bold text-lg">我的加分申请</h3>
                            <p class="text-sm text-gray-600 mt-1">查看您提交的所有加分申请及其审核状态</p>
                        </div>
                        <div class="p-6 table-container">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">类型</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">标题</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">分值</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">状态</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">提交时间</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">审核意见</th>
                                    </tr>
                                </thead>
                                <tbody id="student-applications-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 排名公示页面 -->
                <div id="ranking-tab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="flex items-center space-x-2">
                                        <i data-lucide="trophy" class="h-6 w-6 text-yellow-500"></i>
                                        <h3 class="font-bold text-lg">保研加分排名公示</h3>
                                    </div>
                                    <div class="flex items-center space-x-2 mt-2 text-sm text-gray-600">
                                        <i data-lucide="calendar" class="h-4 w-4"></i>
                                        <span>公示时间：<span id="student-ranking-date"></span></span>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button id="student-export-excel-btn" class="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors text-sm">
                                        <i data-lucide="file-spreadsheet" class="h-4 w-4"></i>
                                        <span>导出Excel</span>
                                    </button>
                                    <button id="student-export-pdf-btn" class="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors text-sm">
                                        <i data-lucide="file-down" class="h-4 w-4"></i>
                                        <span>导出PDF</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-sm font-bold">公示说明</h4>
                                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                                    <li>• 排名基于已审核通过的加分项目计算</li>
                                    <li>• 公示期为7个工作日，如有异议请及时联系管理员</li>
                                    <li>• 最终排名将作为保研推荐的重要参考依据</li>
                                    <li>• 数据实时更新，以最新审核结果为准</li>
                                </ul>
                            </div>
                            <div class="table-container">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-center py-3 px-4 text-sm font-medium text-gray-700 w-20">排名</th>
                                            <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">学号</th>
                                            <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">姓名</th>
                                            <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">总分</th>
                                            <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">通过项目数</th>
                                            <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">最后更新</th>
                                            <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">状态</th>
                                        </tr>
                                    </thead>
                                    <tbody id="student-ranking-table"></tbody>
                                </table>
                            </div>
                            <div class="text-center space-y-2">
                                <p class="text-sm text-gray-500" id="student-ranking-count"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 【前端】管理员端界面 -->
    <div id="admin-dashboard" class="hidden">
        <!-- 顶部导航 -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-3">
                        <i data-lucide="trophy" class="h-8 w-8 text-blue-600"></i>
                        <div>
                            <h1 class="text-xl font-bold">保研加分小助手</h1>
                            <p class="text-sm text-gray-500">管理员端</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <p class="text-sm font-medium" id="admin-name"></p>
                            <p class="text-xs text-gray-500">管理员</p>
                        </div>
                        <button id="admin-logout-btn" class="flex items-center space-x-2 px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition-colors">
                            <i data-lucide="log-out" class="h-4 w-4"></i>
                            <span>退出登录</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- 统计卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">待审核申请</h3>
                        <i data-lucide="file-check" class="h-4 w-4 text-orange-600"></i>
                    </div>
                    <p class="text-2xl font-bold" id="admin-pending-count">0</p>
                    <p class="text-xs text-gray-500 mt-1">需要处理的申请</p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">总申请数</h3>
                        <i data-lucide="trophy" class="h-4 w-4 text-blue-600"></i>
                    </div>
                    <p class="text-2xl font-bold" id="admin-total-applications">0</p>
                    <p class="text-xs text-gray-500 mt-1">累计提交申请</p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">已通过申请</h3>
                        <i data-lucide="check-circle" class="h-4 w-4 text-green-600"></i>
                    </div>
                    <p class="text-2xl font-bold" id="admin-approved-count">0</p>
                    <p class="text-xs text-gray-500 mt-1">审核通过的申请</p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-medium text-gray-600">学生总数</h3>
                        <i data-lucide="users" class="h-4 w-4 text-purple-600"></i>
                    </div>
                    <p class="text-2xl font-bold" id="admin-student-count">0</p>
                    <p class="text-xs text-gray-500 mt-1">参与保研的学生</p>
                </div>
            </div>

            <!-- Tab导航 -->
            <div class="mb-6">
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-8">
                        <button class="admin-tab py-4 px-1 border-b-2 font-medium text-sm transition-colors border-blue-500 text-blue-600" data-tab="review">
                            申请审核
                        </button>
                        <button class="admin-tab py-4 px-1 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="students">
                            学生管理
                        </button>
                        <button class="admin-tab py-4 px-1 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="ranking">
                            排名公示
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Tab内容区 -->
            <div id="admin-tab-content">
                <!-- 申请审核页面 -->
                <div id="review-tab" class="tab-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">申请审核</h2>
                        <button id="admin-export-ranking-btn" class="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                            <i data-lucide="download" class="h-4 w-4"></i>
                            <span>导出排名表格</span>
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <h3 class="font-bold text-lg">所有申请</h3>
                            <p class="text-sm text-gray-600 mt-1">点击申请可查看详情并进行审核</p>
                        </div>
                        <div class="p-6 table-container">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">学生</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">类型</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">标题</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">申请分值</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">状态</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">提交时间</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-review-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 学生管理页面 -->
                <div id="students-tab" class="tab-content hidden">
                    <h2 class="text-xl font-bold mb-6">学生管理</h2>
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <h3 class="font-bold text-lg">学生列表</h3>
                            <p class="text-sm text-gray-600 mt-1">管理参与保研的学生账户信息</p>
                        </div>
                        <div class="p-6 table-container">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">学号</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">姓名</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">申请数量</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">已获得分数</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-students-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 排名公示页面 -->
                <div id="admin-ranking-tab" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">排名公示</h2>
                        <button id="admin-export-ranking-btn2" class="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                            <i data-lucide="download" class="h-4 w-4"></i>
                            <span>导出排名表格</span>
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <div class="flex items-center space-x-2">
                                <i data-lucide="trophy" class="h-6 w-6 text-yellow-500"></i>
                                <h3 class="font-bold text-lg">保研加分排名公示</h3>
                            </div>
                            <div class="flex items-center space-x-2 mt-2 text-sm text-gray-600">
                                <i data-lucide="calendar" class="h-4 w-4"></i>
                                <span>公示时间：<span id="admin-ranking-date"></span></span>
                            </div>
                        </div>
                        <div class="p-6 table-container">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-center py-3 px-4 text-sm font-medium text-gray-700 w-20">排名</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">学号</th>
                                        <th class="text-left py-3 px-4 text-sm font-medium text-gray-700">姓名</th>
                                        <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">总分</th>
                                        <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">通过项目数</th>
                                        <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">最后更新</th>
                                        <th class="text-center py-3 px-4 text-sm font-medium text-gray-700">状态</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-ranking-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 【前端】上传弹窗 -->
    <div id="upload-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[85vh] overflow-y-auto fade-in">
            <div class="p-6 border-b">
                <h3 class="text-lg font-bold" id="upload-modal-title"></h3>
                <p class="text-sm text-gray-600 mt-1" id="upload-modal-description"></p>
            </div>
            <div class="p-6 space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">具体类型</label>
                    <select id="upload-subtype" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">请选择具体类型</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">申请标题</label>
                    <input type="text" id="upload-title" placeholder="请输入申请标题（如：全国大学生数学建模竞赛一等奖）" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">详细描述</label>
                    <textarea id="upload-description" rows="4" placeholder="请详细描述您的成果（如：2024年全国大学生数学建模竞赛省级赛区一等奖，团队第一完成人）" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">申请分值</label>
                    <div class="flex items-center space-x-2">
                        <input type="number" id="upload-points" min="1" placeholder="请输入申请分值" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <span class="text-sm text-gray-500" id="upload-max-points"></span>
                    </div>
                    <p id="upload-points-error" class="text-sm text-red-600 mt-1 hidden">申请分值不能超过该类型的最高分值</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">上传证明文件</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 space-y-4">
                        <button id="upload-file-btn" class="w-full px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center justify-center space-x-2">
                            <i data-lucide="upload" class="h-4 w-4"></i>
                            <span>选择文件</span>
                        </button>
                        <div id="uploaded-files-list" class="space-y-2 hidden">
                            <p class="text-sm font-medium">已上传文件：</p>
                            <div id="uploaded-files"></div>
                        </div>
                        <p class="text-xs text-gray-500">支持上传PDF、JPG、PNG格式文件，建议上传清晰的扫描件或照片</p>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t flex justify-end space-x-4">
                <button id="upload-cancel-btn" class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">取消</button>
                <button id="upload-submit-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">提交申请</button>
            </div>
        </div>
    </div>

    <!-- 【前端】审核弹窗 -->
    <div id="review-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-y-auto fade-in">
            <div class="p-6 border-b">
                <div class="flex items-center space-x-2">
                    <i data-lucide="file-text" class="h-5 w-5"></i>
                    <h3 class="text-lg font-bold">申请审核详情</h3>
                </div>
                <p class="text-sm text-gray-600 mt-1">请仔细查看申请材料并给出审核意见</p>
            </div>
            <div class="p-6 space-y-6">
                <!-- 申请信息卡片 -->
                <div class="bg-white border border-gray-200 rounded-lg p-6 space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="award" class="h-5 w-5"></i>
                            <h4 class="font-bold">申请信息</h4>
                        </div>
                        <span id="review-status-badge"></span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="flex items-center space-x-2 text-sm text-gray-600 mb-1">
                                <i data-lucide="user" class="h-4 w-4"></i>
                                <span>申请人</span>
                            </div>
                            <p id="review-student-info"></p>
                        </div>
                        <div>
                            <div class="flex items-center space-x-2 text-sm text-gray-600 mb-1">
                                <i data-lucide="tag" class="h-4 w-4"></i>
                                <span>申请类型</span>
                            </div>
                            <p id="review-type"></p>
                        </div>
                        <div>
                            <div class="flex items-center space-x-2 text-sm text-gray-600 mb-1">
                                <i data-lucide="calendar" class="h-4 w-4"></i>
                                <span>提交时间</span>
                            </div>
                            <p id="review-submitted-at"></p>
                        </div>
                        <div>
                            <div class="flex items-center space-x-2 text-sm text-gray-600 mb-1">
                                <i data-lucide="award" class="h-4 w-4"></i>
                                <span>申请分值</span>
                            </div>
                            <p id="review-points" class="text-lg font-bold"></p>
                        </div>
                    </div>
                    <hr>
                    <div>
                        <h4 class="font-medium mb-2">申请标题</h4>
                        <p id="review-title" class="text-lg"></p>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">详细描述</h4>
                        <p id="review-description" class="text-gray-700 bg-gray-50 p-3 rounded-md"></p>
                    </div>
                </div>

                <!-- 上传文件 -->
                <div class="bg-white border border-gray-200 rounded-lg p-6">
                    <div class="flex items-center space-x-2 mb-4">
                        <i data-lucide="file-text" class="h-5 w-5"></i>
                        <h4 class="font-bold">上传文件</h4>
                    </div>
                    <div id="review-files" class="space-y-2"></div>
                    <p class="text-sm text-gray-500 mt-2">点击"查看"按钮可以预览或下载文件（演示环境下为模拟功能）</p>
                </div>

                <!-- 历史审核记录 -->
                <div id="review-history" class="bg-white border border-gray-200 rounded-lg p-6 hidden">
                    <div class="flex items-center space-x-2 mb-4">
                        <i data-lucide="message-square" class="h-5 w-5"></i>
                        <h4 class="font-bold">历史审核记录</h4>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600" id="review-reviewed-at"></span>
                            <span id="review-history-badge"></span>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-md">
                            <p id="review-history-comment"></p>
                        </div>
                    </div>
                </div>

                <!-- 审核表单（仅待审核状态显示） -->
                <div id="review-form" class="bg-white border border-gray-200 rounded-lg p-6">
                    <div class="flex items-center space-x-2 mb-4">
                        <i data-lucide="message-square" class="h-5 w-5"></i>
                        <h4 class="font-bold">审核意见</h4>
                    </div>
                    <div class="space-y-4">
                        <div class="flex space-x-4">
                            <button id="review-approve-btn" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                                通过
                            </button>
                            <button id="review-reject-btn" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors">
                                驳回
                            </button>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">审核意见</label>
                            <textarea id="review-comment" rows="4" placeholder="请先选择审核结果，然后填写审核意见" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        <div class="text-sm text-gray-500 bg-blue-50 p-3 rounded-md">
                            <p class="font-bold">审核建议：</p>
                            <ul class="list-disc list-inside space-y-1 mt-1">
                                <li>仔细核实证明材料的真实性和有效性</li>
                                <li>确认申请分值是否符合相关标准</li>
                                <li>如需驳回，请详细说明理由和改进建议</li>
                                <li>审核意见将发送给申请学生，请用词准确、客观</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t flex justify-end space-x-4">
                <button id="review-close-btn" class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">关闭</button>
                <button id="review-submit-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">提交审核</button>
            </div>
        </div>
    </div>

    <script>
        // ===================================================================
        // 【前端】全局状态管理
        // ===================================================================
        const AppState = {
            currentUser: null,  // 当前登录用户
            applications: [],   // 所有申请数据
            students: [],       // 所有学生数据
            rankings: [],       // 排名数据
            currentUploadCategory: null,  // 当前上传分类
            currentReviewApplication: null,  // 当前审核的申请
            reviewDecision: null  // 审核决定（approved/rejected）
        };

        // ===================================================================
        // 【前端】上传分类配置（与后端数据库对应）
        // ===================================================================
        const UPLOAD_CATEGORIES = {
            competition: {
                id: 'competition',
                title: '竞赛加分',
                description: '上传竞赛获奖证书（国家级、省级、校级等）',
                types: [
                    { value: '国家级竞赛特等奖', label: '国家级竞赛特等奖', maxPoints: 25 },
                    { value: '国家级竞赛一等奖', label: '国家级竞赛一等奖', maxPoints: 20 },
                    { value: '省级竞赛一等奖', label: '省级竞赛一等奖', maxPoints: 15 },
                    { value: '省级竞赛二等奖', label: '省级竞赛二等奖', maxPoints: 10 },
                    { value: '校级竞赛一等奖', label: '校级竞赛一等奖', maxPoints: 5 }
                ]
            },
            paper: {
                id: 'paper',
                title: '论文加分',
                description: '上传发表论文或会议收录证明（PDF/图片）',
                types: [
                    { value: 'SCI一区论文', label: 'SCI一区论文（第一作者）', maxPoints: 30 },
                    { value: 'SCI二区论文', label: 'SCI二区论文（第一作者）', maxPoints: 25 },
                    { value: '核心期刊论文', label: '核心期刊论文（第一作者）', maxPoints: 20 },
                    { value: '国际会议论文', label: '国际会议论文（第一作者）', maxPoints: 15 },
                    { value: '普通期刊论文', label: '普通期刊论文（第一作者）', maxPoints: 10 }
                ]
            },
            patent: {
                id: 'patent',
                title: '专利加分',
                description: '上传国家发明专利或实用新型专利证书',
                types: [
                    { value: '发明专利', label: '国家发明专利（第一发明人）', maxPoints: 25 },
                    { value: '实用新型专利', label: '实用新型专利（第一发明人）', maxPoints: 15 },
                    { value: '外观设计专利', label: '外观设计专利（第一发明人）', maxPoints: 10 },
                    { value: '软件著作权', label: '软件著作权（第一作者）', maxPoints: 8 }
                ]
            },
            comprehensive: {
                id: 'comprehensive',
                title: '综合表现',
                description: '上传荣誉证书、志愿服务证明、学生工作证明等',
                types: [
                    { value: '国家级荣誉', label: '国家级荣誉称号', maxPoints: 15 },
                    { value: '省级荣誉', label: '省级荣誉称号', maxPoints: 10 },
                    { value: '校级荣誉', label: '校级荣誉称号', maxPoints: 5 },
                    { value: '志愿服务', label: '志愿服务（累计100小时以上）', maxPoints: 8 },
                    { value: '学生工作', label: '学生干部工作（一年以上）', maxPoints: 6 },
                    { value: '社会实践', label: '社会实践优秀个人', maxPoints: 5 }
                ]
            }
        };

        // ===================================================================
        // 【前端】工具函数
        // ===================================================================
        
        // 显示Toast通知
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `px-4 py-3 rounded-md shadow-lg mb-2 text-white ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            } fade-in`;
            toast.textContent = message;
            
            const container = document.getElementById('toast-container');
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // 格式化日期
        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toISOString().split('T')[0];
        }

        // 获取当前日期字符串
        function getCurrentDateString() {
            const now = new Date();
            return `${now.getFullYear()}年${now.getMonth() + 1}月${now.getDate()}日`;
        }

        // 生成随机ID
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        // 获取状态徽章HTML
        function getStatusBadge(status) {
            const badges = {
                pending: '<span class="px-2 py-1 text-xs rounded-full bg-gray-200 text-gray-700">待审核</span>',
                approved: '<span class="px-2 py-1 text-xs rounded-full bg-blue-600 text-white">已通过</span>',
                rejected: '<span class="px-2 py-1 text-xs rounded-full bg-red-600 text-white">已驳回</span>'
            };
            return badges[status] || '';
        }

        // 获取排名图标HTML
        function getRankIcon(rank) {
            if (rank === 1) return '🥇</i>';
            if (rank === 2) return '🥈</i>';
            if (rank === 3) return '🥉</i>';
            return `<span class="text-lg font-bold">${rank}</span>`;
        }

        // 获取排名徽章HTML
        function getRankBadge(rank) {
            if (rank <= 3) return '<span class="px-2 py-1 text-xs rounded-full bg-blue-600 text-white">前三名</span>';
            if (rank <= 10) return '<span class="px-2 py-1 text-xs rounded-full bg-gray-200 text-gray-700">前十名</span>';
            return '';
        }

        // ===================================================================
        // 【需要后端】数据初始化 - 这些数据在实际应用中应从后端API获取
        // ===================================================================
        function initMockData() {
            // 模拟学生数据
            AppState.students = [
                { id: '1', name: '张三', studentId: '2021001001', role: 'student', major: '计算机科学与技术' },
                { id: '2', name: '李四', studentId: '2021001002', role: 'student', major: '软件工程' },
                { id: '3', name: '王五', studentId: '2021001003', role: 'student', major: '人工智能' },
                { id: '4', name: '赵六', studentId: '2021001004', role: 'student', major: '数据科学' },
                { id: '5', name: '钱七', studentId: '2021001005', role: 'student', major: '网络工程' },
                { id: '6', name: '孙八', studentId: '2021001006', role: 'student', major: '信息安全' },
                { id: '7', name: '周九', studentId: '2021001007', role: 'student', major: '物联网工程' },
                { id: '8', name: '吴十', studentId: '2021001008', role: 'student', major: '电子信息工程' }
            ];

            // 模拟申请数据
            AppState.applications = [
                {
                    id: '1',
                    studentId: '2021001001',
                    studentName: '张三',
                    type: '竞赛加分',
                    title: '全国大学生数学建模竞赛',
                    description: '省级竞赛一等奖 - 获得省级一等奖',
                    points: 15,
                    status: 'approved',
                    submittedAt: '2024-01-15',
                    reviewedAt: '2024-01-18',
                    reviewComment: '材料齐全，符合加分标准',
                    files: ['竞赛证书.pdf']
                },
                {
                    id: '2',
                    studentId: '2021001001',
                    studentName: '张三',
                    type: '论文加分',
                    title: 'AI在教育领域的应用研究',
                    description: '核心期刊论文 - 第一作者，发表在核心期刊',
                    points: 20,
                    status: 'pending',
                    submittedAt: '2024-02-20',
                    files: ['论文截图.png', '期刊封面.jpg']
                },
                {
                    id: '3',
                    studentId: '2021001002',
                    studentName: '李四',
                    type: '竞赛加分',
                    title: 'ACM国际大学生程序设计竞赛',
                    description: '省级竞赛一等奖 - 获得区域赛金奖',
                    points: 15,
                    status: 'approved',
                    submittedAt: '2024-02-18',
                    reviewedAt: '2024-02-20',
                    reviewComment: '成绩优异，符合标准',
                    files: ['获奖证书.pdf', '参赛照片.jpg']
                },
                {
                    id: '4',
                    studentId: '2021001002',
                    studentName: '李四',
                    type: '论文加分',
                    title: '机器学习在金融风控中的应用',
                    description: '国际会议论文 - 第一作者，发表在国际会议',
                    points: 13,
                    status: 'pending',
                    submittedAt: '2024-02-22',
                    files: ['论文首页.pdf']
                },
                {
                    id: '5',
                    studentId: '2021001003',
                    studentName: '王五',
                    type: '专利加分',
                    title: '基于深度学习的图像识别系统',
                    description: '实用新型专利 - 第一发明人',
                    points: 15,
                    status: 'approved',
                    submittedAt: '2024-01-20',
                    reviewedAt: '2024-01-25',
                    reviewComment: '专利证书有效，符合要求',
                    files: ['专利证书.pdf']
                },
                {
                    id: '6',
                    studentId: '2021001003',
                    studentName: '王五',
                    type: '综合表现',
                    title: '优秀学生干部',
                    description: '校级荣誉 - 担任学生会主席一年',
                    points: 5,
                    status: 'pending',
                    submittedAt: '2024-02-23',
                    files: ['荣誉证书.jpg']
                }
            ];

            // 计算排名数据
            calculateRankings();
        }

        // 计算排名
        function calculateRankings() {
            const studentScores = {};
            
            // 计算每个学生的总分
            AppState.students.forEach(student => {
                const approvedApps = AppState.applications.filter(
                    app => app.studentId === student.studentId && app.status === 'approved'
                );
                const totalPoints = approvedApps.reduce((sum, app) => sum + app.points, 0);
                
                studentScores[student.studentId] = {
                    studentId: student.studentId,
                    studentName: student.name,
                    totalPoints: totalPoints,
                    approvedApplications: approvedApps.length,
                    lastUpdate: approvedApps.length > 0 ? 
                        approvedApps[approvedApps.length - 1].reviewedAt || formatDate(new Date()) :
                        formatDate(new Date())
                };
            });

            // 排序并添加排名
            AppState.rankings = Object.values(studentScores)
                .sort((a, b) => b.totalPoints - a.totalPoints)
                .map((student, index) => ({
                    ...student,
                    rank: index + 1
                }));
        }

        // ===================================================================
        // 【前端+需要后端】登录逻辑
        // ===================================================================
        document.getElementById('login-role').addEventListener('change', function() {
            const label = document.getElementById('login-username-label');
            const input = document.getElementById('login-username');
            if (this.value === 'student') {
                label.textContent = '学号';
                input.placeholder = '请输入学号';
            } else {
                label.textContent = '工号';
                input.placeholder = '请输入工号';
            }
        });

        document.getElementById('login-btn').addEventListener('click', function() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const role = document.getElementById('login-role').value;

            if (!username || !password) {
                showToast('请输入用户名和密码', 'error');
                return;
            }

            // 【需要后端】这里应该调用后端API验证用户身份
            // 实际应用：POST /api/auth/login { username, password, role }
            // 现在使用模拟登录
            if (password === '123456') {
                if (role === 'student') {
                    // 查找学生
                    let student = AppState.students.find(s => s.studentId === username || s.name === username);
                    if (!student && username === 'student') {
                        // 使用默认学生账号
                        student = AppState.students[0];
                    }
                    if (student) {
                        AppState.currentUser = { ...student, role: 'student' };
                        showStudentDashboard();
                        showToast('登录成功！');
                    } else {
                        showToast('学生账号不存在', 'error');
                    }
                } else {
                    // 管理员登录
                    AppState.currentUser = {
                        id: 'admin1',
                        name: username === 'admin' ? '管理员' : username,
                        role: 'admin'
                    };
                    showAdminDashboard();
                    showToast('登录成功！');
                }
            } else {
                showToast('用户名或密码错误', 'error');
            }
        });

        // ===================================================================
        // 【前端】显示学生端界面
        // ===================================================================
        function showStudentDashboard() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('student-dashboard').classList.remove('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');

            // 更新用户信息
            document.getElementById('student-name').textContent = AppState.currentUser.name;
            document.getElementById('student-id').textContent = '学号: ' + AppState.currentUser.studentId;
            document.getElementById('upload-student-name').textContent = AppState.currentUser.name;
            document.getElementById('upload-student-id').textContent = AppState.currentUser.studentId;
            document.getElementById('upload-student-major').textContent = AppState.currentUser.major || '未设置专业';

            // 更新统计数据
            updateStudentStats();

            // 更新申请列表
            updateStudentApplicationsList();

            // 更新排名
            updateStudentRanking();

            // 初始化图标
            lucide.createIcons();
        }

        // 更新学生统计数据
        function updateStudentStats() {
            const studentApps = AppState.applications.filter(
                app => app.studentId === AppState.currentUser.studentId
            );
            
            const approvedApps = studentApps.filter(app => app.status === 'approved');
            const pendingApps = studentApps.filter(app => app.status === 'pending');
            const totalPoints = approvedApps.reduce((sum, app) => sum + app.points, 0);

            document.getElementById('student-total-points').textContent = totalPoints + ' 分';
            document.getElementById('student-pending-count').textContent = pendingApps.length + ' 项';
            document.getElementById('student-total-applications').textContent = studentApps.length + ' 项';

            // 更新进度条
            const reviewedCount = studentApps.filter(app => app.status !== 'pending').length;
            const totalCount = studentApps.length;
            const percentage = totalCount > 0 ? (reviewedCount / totalCount) * 100 : 0;

            document.getElementById('progress-reviewed').textContent = reviewedCount;
            document.getElementById('progress-pending').textContent = pendingApps.length;
            document.getElementById('progress-total').textContent = totalCount;
            document.getElementById('progress-bar').style.width = percentage + '%';

            if (totalCount === 0) {
                document.getElementById('progress-text').textContent = '暂无申请记录，请点击上方卡片上传材料';
            } else {
                document.getElementById('progress-text').textContent = 
                    `${reviewedCount} / ${totalCount} 项已完成审核 (${Math.round(percentage)}%)`;
            }
        }

        // 更新学生申请列表
        function updateStudentApplicationsList() {
            const tbody = document.getElementById('student-applications-table');
            const studentApps = AppState.applications.filter(
                app => app.studentId === AppState.currentUser.studentId
            );

            if (studentApps.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">暂无申请记录</td></tr>';
                return;
            }

            tbody.innerHTML = studentApps.map(app => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="py-3 px-4">${app.type}</td>
                    <td class="py-3 px-4">
                        <div>
                            <p class="font-medium">${app.title}</p>
                            <p class="text-sm text-gray-500">${app.description}</p>
                        </div>
                    </td>
                    <td class="py-3 px-4">${app.points}</td>
                    <td class="py-3 px-4">${getStatusBadge(app.status)}</td>
                    <td class="py-3 px-4">${app.submittedAt}</td>
                    <td class="py-3 px-4">
                        ${app.reviewComment ? `
                            <div class="max-w-xs">
                                <p class="text-sm">${app.reviewComment}</p>
                                ${app.reviewedAt ? `<p class="text-xs text-gray-500">${app.reviewedAt}</p>` : ''}
                            </div>
                        ` : '-'}
                    </td>
                </tr>
            `).join('');

            lucide.createIcons();
        }

        // 更新学生排名
        function updateStudentRanking() {
            const tbody = document.getElementById('student-ranking-table');
            document.getElementById('student-ranking-date').textContent = getCurrentDateString();
            document.getElementById('student-ranking-count').textContent = `共有 ${AppState.rankings.length} 名学生参与排名`;

            tbody.innerHTML = AppState.rankings.map(student => {
                const isCurrentUser = student.studentId === AppState.currentUser.studentId;
                return `
                    <tr class="border-b hover:bg-gray-50 ${isCurrentUser ? 'current-user-row' : ''}">
                        <td class="py-3 px-4 text-center">${getRankIcon(student.rank)}</td>
                        <td class="py-3 px-4">
                            <div class="flex items-center space-x-2">   
                                <span>${student.studentId}</span>
                                ${isCurrentUser ? '<span class="px-2 py-0.5 text-xs rounded-full border border-blue-600 text-blue-600">我</span>' : ''}
                            </div>
                        </td>
                        <td class="py-3 px-4">${student.studentName}</td>
                        <td class="py-3 px-4 text-center">
                            <span class="text-lg font-bold">${student.totalPoints}</span>
                            <span class="text-sm text-gray-500 ml-1">分</span>
                        </td>
                        <td class="py-3 px-4 text-center">${student.approvedApplications}</td>
                        <td class="py-3 px-4 text-center text-sm text-gray-500">${student.lastUpdate}</td>
                        <td class="py-3 px-4 text-center">${getRankBadge(student.rank)}</td>
                    </tr>
                `;
            }).join('');

            lucide.createIcons();
        }

        // ===================================================================
        // 【前端】学生端Tab切换
        // ===================================================================
        document.querySelectorAll('.student-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // 更新Tab状态
                document.querySelectorAll('.student-tab').forEach(t => {
                    t.classList.remove('border-blue-500', 'text-blue-600');
                    t.classList.add('border-transparent', 'text-gray-500');
                });
                this.classList.remove('border-transparent', 'text-gray-500');
                this.classList.add('border-blue-500', 'text-blue-600');

                // 显示对应内容
                const tabName = this.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName + '-tab').classList.remove('hidden');

                // 重新初始化图标
                lucide.createIcons();
            });
        });

        // ===================================================================
        // 【前端+需要后端】学生端上传功能
        // ===================================================================
        document.querySelectorAll('.upload-category-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const categoryId = this.dataset.category;
                AppState.currentUploadCategory = UPLOAD_CATEGORIES[categoryId];
                showUploadModal();
            });
        });

        function showUploadModal() {
            const modal = document.getElementById('upload-modal');
            const category = AppState.currentUploadCategory;

            // 设置标题和描述
            document.getElementById('upload-modal-title').textContent = category.title;
            document.getElementById('upload-modal-description').textContent = category.description;

            // 填充子类型选项
            const subtypeSelect = document.getElementById('upload-subtype');
            subtypeSelect.innerHTML = '<option value="">请选择具体类型</option>' +
                category.types.map(type => 
                    `<option value="${type.value}" data-max-points="${type.maxPoints}">${type.label} (最高${type.maxPoints}分)</option>`
                ).join('');

            // 清空表单
            document.getElementById('upload-title').value = '';
            document.getElementById('upload-description').value = '';
            document.getElementById('upload-points').value = '';
            document.getElementById('upload-max-points').textContent = '';
            document.getElementById('uploaded-files').innerHTML = '';
            document.getElementById('uploaded-files-list').classList.add('hidden');
            document.getElementById('upload-points-error').classList.add('hidden');

            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        // 子类型选择变化
        document.getElementById('upload-subtype').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const maxPoints = selectedOption.dataset.maxPoints;
            if (maxPoints) {
                document.getElementById('upload-max-points').textContent = `最高 ${maxPoints} 分`;
            } else {
                document.getElementById('upload-max-points').textContent = '';
            }
        });

        // 分值输入验证
        document.getElementById('upload-points').addEventListener('input', function() {
            const subtypeSelect = document.getElementById('upload-subtype');
            const selectedOption = subtypeSelect.options[subtypeSelect.selectedIndex];
            const maxPoints = parseInt(selectedOption.dataset.maxPoints);
            const inputPoints = parseInt(this.value);

            const errorElement = document.getElementById('upload-points-error');
            if (inputPoints > maxPoints) {
                errorElement.classList.remove('hidden');
            } else {
                errorElement.classList.add('hidden');
            }
        });

        // 【前端】文件上传（模拟）
        let uploadedFiles = [];
        document.getElementById('upload-file-btn').addEventListener('click', function() {
            // 【需要后端】实际应用中应该调用文件上传API
            // 实际应用：POST /api/files/upload (multipart/form-data)
            const mockFiles = [
                '证书扫描件.pdf',
                '获奖证书.jpg',
                '论文首页.png',
                '专利证书.pdf',
                '荣誉证书.jpg',
                '参赛照片.jpg',
                '期刊封面.pdf'
            ];
            const randomFile = mockFiles[Math.floor(Math.random() * mockFiles.length)];
            uploadedFiles.push(randomFile);

            updateUploadedFilesList();
            showToast('文件上传成功');
        });

        function updateUploadedFilesList() {
            const container = document.getElementById('uploaded-files');
            const listContainer = document.getElementById('uploaded-files-list');

            if (uploadedFiles.length === 0) {
                listContainer.classList.add('hidden');
                return;
            }

            listContainer.classList.remove('hidden');
            container.innerHTML = uploadedFiles.map((file, index) => `
                <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                    <span class="text-sm">${file}</span>
                    <button class="remove-file-btn text-gray-500 hover:text-red-600" data-index="${index}">
                        <i data-lucide="x" class="h-4 w-4"></i>
                    </button>
                </div>
            `).join('');

            // 绑定删除事件
            document.querySelectorAll('.remove-file-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    uploadedFiles.splice(index, 1);
                    updateUploadedFilesList();
                });
            });

            lucide.createIcons();
        }

        // 取消上传
        document.getElementById('upload-cancel-btn').addEventListener('click', function() {
            document.getElementById('upload-modal').classList.add('hidden');
            uploadedFiles = [];
        });

        // 【需要后端】提交申请
        document.getElementById('upload-submit-btn').addEventListener('click', function() {
            const subtype = document.getElementById('upload-subtype').value;
            const title = document.getElementById('upload-title').value;
            const description = document.getElementById('upload-description').value;
            const points = parseInt(document.getElementById('upload-points').value);

            if (!subtype || !title || !description || !points) {
                showToast('请填写完整的申请信息', 'error');
                return;
            }

            if (uploadedFiles.length === 0) {
                showToast('请至少上传一个证明文件', 'error');
                return;
            }

            const subtypeSelect = document.getElementById('upload-subtype');
            const selectedOption = subtypeSelect.options[subtypeSelect.selectedIndex];
            const maxPoints = parseInt(selectedOption.dataset.maxPoints);
            
            if (points > maxPoints) {
                showToast(`申请分值不能超过${maxPoints}分`, 'error');
                return;
            }

            // 【需要后端】实际应用中应该调用API提交申请
            // 实际应用：POST /api/applications { studentId, type, subType, title, description, points, files }
            const newApplication = {
                id: generateId(),
                studentId: AppState.currentUser.studentId,
                studentName: AppState.currentUser.name,
                type: AppState.currentUploadCategory.title,
                title: title,
                description: `${subtype} - ${description}`,
                points: points,
                status: 'pending',
                submittedAt: formatDate(new Date()),
                files: [...uploadedFiles]
            };

            AppState.applications.push(newApplication);
            
            // 更新界面
            updateStudentStats();
            updateStudentApplicationsList();
            
            // 关闭弹窗
            document.getElementById('upload-modal').classList.add('hidden');
            uploadedFiles = [];
            
            showToast('申请提交成功！等待管理员审核');
        });

        // ===================================================================
        // 【前端】学生端导出功能（模拟）
        // ===================================================================
        document.getElementById('student-export-excel-btn').addEventListener('click', function() {
            // 【需要后端】实际应用中应该调用API生成Excel文件
            // 实际应用：GET /api/rankings/export/excel
            showToast('正在导出Excel文件...（演示功能）', 'info');
            console.log('导出排名数据（Excel格式）:', AppState.rankings);
        });

        document.getElementById('student-export-pdf-btn').addEventListener('click', function() {
            // 【需要后端】实际应用中应该调用API生成PDF文件
            // 实际应用：GET /api/rankings/export/pdf
            showToast('正在导出PDF文件...（演示功能）', 'info');
            console.log('导出排名数据（PDF格式）:', AppState.rankings);
        });

        // ===================================================================
        // 【前端】学生端退出登录
        // ===================================================================
        document.getElementById('student-logout-btn').addEventListener('click', function() {
            logout();
        });

        // ===================================================================
        // 【前端】显示管理员端界面
        // ===================================================================
        function showAdminDashboard() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('student-dashboard').classList.add('hidden');
            document.getElementById('admin-dashboard').classList.remove('hidden');

            // 更新用户信息
            document.getElementById('admin-name').textContent = AppState.currentUser.name;

            // 更新统计数据
            updateAdminStats();

            // 更新申请列表
            updateAdminReviewTable();

            // 更新学生列表
            updateAdminStudentsTable();

            // 更新排名
            updateAdminRanking();

            // 初始化图标
            lucide.createIcons();
        }

        // 更新管理员统计数据
        function updateAdminStats() {
            const pendingCount = AppState.applications.filter(app => app.status === 'pending').length;
            const totalCount = AppState.applications.length;
            const approvedCount = AppState.applications.filter(app => app.status === 'approved').length;
            const studentCount = AppState.students.length;

            document.getElementById('admin-pending-count').textContent = pendingCount;
            document.getElementById('admin-total-applications').textContent = totalCount;
            document.getElementById('admin-approved-count').textContent = approvedCount;
            document.getElementById('admin-student-count').textContent = studentCount;
        }

        // 更新管理员审核表格
        function updateAdminReviewTable() {
            const tbody = document.getElementById('admin-review-table');

            if (AppState.applications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">暂无申请记录</td></tr>';
                return;
            }

            tbody.innerHTML = AppState.applications.map(app => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="py-3 px-4">
                        <div>
                            <p class="font-medium">${app.studentName}</p>
                            <p class="text-sm text-gray-500">${app.studentId}</p>
                        </div>
                    </td>
                    <td class="py-3 px-4">${app.type}</td>
                    <td class="py-3 px-4">
                        <div>
                            <p class="font-medium">${app.title}</p>
                            <p class="text-sm text-gray-500">${app.description}</p>
                        </div>
                    </td>
                    <td class="py-3 px-4">${app.points}</td>
                    <td class="py-3 px-4">${getStatusBadge(app.status)}</td>
                    <td class="py-3 px-4">${app.submittedAt}</td>
                    <td class="py-3 px-4">
                        <button class="review-app-btn px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 transition-colors" data-app-id="${app.id}">
                            ${app.status === 'pending' ? '审核' : '查看'}
                        </button>
                    </td>
                </tr>
            `).join('');

            // 绑定审核按钮事件
            document.querySelectorAll('.review-app-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.dataset.appId;
                    const application = AppState.applications.find(app => app.id === appId);
                    if (application) {
                        AppState.currentReviewApplication = application;
                        showReviewModal();
                    }
                });
            });

            lucide.createIcons();
        }

        // 更新管理员学生表格
        function updateAdminStudentsTable() {
            const tbody = document.getElementById('admin-students-table');

            tbody.innerHTML = AppState.students.map(student => {
                const studentApps = AppState.applications.filter(app => app.studentId === student.studentId);
                const approvedApps = studentApps.filter(app => app.status === 'approved');
                const totalPoints = approvedApps.reduce((sum, app) => sum + app.points, 0);

                return `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-3 px-4">${student.studentId}</td>
                        <td class="py-3 px-4">${student.name}</td>
                        <td class="py-3 px-4">${studentApps.length}</td>
                        <td class="py-3 px-4">${totalPoints} 分</td>
                        <td class="py-3 px-4">
                            <button class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 transition-colors">
                                查看详情
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            lucide.createIcons();
        }

        // 更新管理员排名
        function updateAdminRanking() {
            const tbody = document.getElementById('admin-ranking-table');
            document.getElementById('admin-ranking-date').textContent = getCurrentDateString();

            tbody.innerHTML = AppState.rankings.map(student => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="py-3 px-4 text-center">${getRankIcon(student.rank)}</td>
                    <td class="py-3 px-4">${student.studentId}</td>
                    <td class="py-3 px-4">${student.studentName}</td>
                    <td class="py-3 px-4 text-center">
                        <span class="text-lg font-bold">${student.totalPoints}</span>
                        <span class="text-sm text-gray-500 ml-1">分</span>
                    </td>
                    <td class="py-3 px-4 text-center">${student.approvedApplications}</td>
                    <td class="py-3 px-4 text-center text-sm text-gray-500">${student.lastUpdate}</td>
                    <td class="py-3 px-4 text-center">${getRankBadge(student.rank)}</td>
                </tr>
            `).join('');

            lucide.createIcons();
        }

        // ===================================================================
        // 【前端】管理员端Tab切换
        // ===================================================================
        document.querySelectorAll('.admin-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // 更新Tab状态
                document.querySelectorAll('.admin-tab').forEach(t => {
                    t.classList.remove('border-blue-500', 'text-blue-600');
                    t.classList.add('border-transparent', 'text-gray-500');
                });
                this.classList.remove('border-transparent', 'text-gray-500');
                this.classList.add('border-blue-500', 'text-blue-600');

                // 显示对应内容
                const tabName = this.dataset.tab;
                document.querySelectorAll('#admin-tab-content .tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                if (tabName === 'ranking') {
                    document.getElementById('admin-ranking-tab').classList.remove('hidden');
                } else {
                    document.getElementById(tabName + '-tab').classList.remove('hidden');
                }

                // 重新初始化图标
                lucide.createIcons();
            });
        });

        // ===================================================================
        // 【前端+需要后端】管理员审核功能
        // ===================================================================
        function showReviewModal() {
            const modal = document.getElementById('review-modal');
            const app = AppState.currentReviewApplication;

            // 填充申请信息
            document.getElementById('review-status-badge').innerHTML = getStatusBadge(app.status);
            document.getElementById('review-student-info').textContent = `${app.studentName} (${app.studentId})`;
            document.getElementById('review-type').textContent = app.type;
            document.getElementById('review-submitted-at').textContent = app.submittedAt;
            document.getElementById('review-points').textContent = app.points + ' 分';
            document.getElementById('review-title').textContent = app.title;
            document.getElementById('review-description').textContent = app.description;

            // 填充文件列表
            const filesContainer = document.getElementById('review-files');
            filesContainer.innerHTML = app.files.map(file => `
                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-md">
                    <div class="flex items-center space-x-2">
                        <i data-lucide="file-text" class="h-4 w-4 text-gray-500"></i>
                        <span>${file}</span>
                    </div>
                    <button class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 transition-colors">
                        查看
                    </button>
                </div>
            `).join('');

            // 显示/隐藏历史记录和审核表单
            const historyDiv = document.getElementById('review-history');
            const formDiv = document.getElementById('review-form');
            const submitBtn = document.getElementById('review-submit-btn');

            if (app.status !== 'pending') {
                // 已审核，显示历史记录
                historyDiv.classList.remove('hidden');
                formDiv.classList.add('hidden');
                submitBtn.classList.add('hidden');

                document.getElementById('review-reviewed-at').textContent = '审核时间：' + (app.reviewedAt || '');
                document.getElementById('review-history-badge').innerHTML = getStatusBadge(app.status);
                document.getElementById('review-history-comment').textContent = app.reviewComment || '';
            } else {
                // 待审核，显示审核表单
                historyDiv.classList.add('hidden');
                formDiv.classList.remove('hidden');
                submitBtn.classList.remove('hidden');

                // 重置审核决定
                AppState.reviewDecision = null;
                document.getElementById('review-comment').value = '';
                // 重置通过按钮为正常绿色
                const approveBtn = document.getElementById('review-approve-btn');
                approveBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                approveBtn.classList.add('bg-green-600', 'hover:bg-green-700', 'text-white');
                // 重置驳回按钮为正常红色
                const rejectBtn = document.getElementById('review-reject-btn');
                rejectBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                rejectBtn.classList.add('bg-red-600', 'hover:bg-red-700', 'text-white');
            }

            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        // 审核决定按钮
        document.getElementById('review-approve-btn').addEventListener('click', function() {
            AppState.reviewDecision = 'approved';
            // 通过按钮点击后变淡（绿色500）
            this.classList.remove('bg-green-600', 'hover:bg-green-700');
            this.classList.add('bg-green-300', 'hover:bg-green-400');
            // 驳回按钮恢复正常（红色600）
            const rejectBtn = document.getElementById('review-reject-btn');
            rejectBtn.classList.remove('bg-red-300', 'hover:bg-red-400');
            rejectBtn.classList.add('bg-red-600', 'hover:bg-red-700');
            document.getElementById('review-comment').placeholder = '请填写通过理由（如：材料齐全，符合加分标准）';
        });

        document.getElementById('review-reject-btn').addEventListener('click', function() {
            AppState.reviewDecision = 'rejected';
            // 驳回按钮点击后变淡（红色500）
            this.classList.remove('bg-red-600', 'hover:bg-red-700');
            this.classList.add('bg-red-300', 'hover:bg-red-400');
            // 通过按钮恢复正常（绿色600）
            const approveBtn = document.getElementById('review-approve-btn');
            approveBtn.classList.remove('bg-green-300', 'hover:bg-green-400');
            approveBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            document.getElementById('review-comment').placeholder = '请填写驳回理由（如：缺少必要证明材料，建议补充...）';
        });

        // 关闭审核弹窗
        document.getElementById('review-close-btn').addEventListener('click', function() {
            document.getElementById('review-modal').classList.add('hidden');
        });

        // 【需要后端】提交审核
        document.getElementById('review-submit-btn').addEventListener('click', function() {
            if (!AppState.reviewDecision) {
                showToast('请选择审核结果', 'error');
                return;
            }

            const comment = document.getElementById('review-comment').value.trim();
            if (!comment) {
                showToast('请填写审核意见', 'error');
                return;
            }

            // 【需要后端】实际应用中应该调用API提交审核结果
            // 实际应用：PUT /api/applications/:id/review { status, comment }
            const appIndex = AppState.applications.findIndex(
                app => app.id === AppState.currentReviewApplication.id
            );

            if (appIndex !== -1) {
                AppState.applications[appIndex] = {
                    ...AppState.applications[appIndex],
                    status: AppState.reviewDecision,
                    reviewComment: comment,
                    reviewedAt: formatDate(new Date())
                };

                // 重新计算排名
                calculateRankings();

                // 更新界面
                updateAdminStats();
                updateAdminReviewTable();
                updateAdminRanking();

                // 如果当前登录的是学生，更新学生端数据
                if (AppState.currentUser.role === 'student') {
                    updateStudentStats();
                    updateStudentApplicationsList();
                    updateStudentRanking();
                }

                // 关闭弹窗
                document.getElementById('review-modal').classList.add('hidden');

                showToast('审核完成');
            }
        });

        // ===================================================================
        // 【前端】管理员导出功能（模拟）
        // ===================================================================
        document.getElementById('admin-export-ranking-btn').addEventListener('click', exportRankings);
        document.getElementById('admin-export-ranking-btn2').addEventListener('click', exportRankings);

        function exportRankings() {
            // 【需要后端】实际应用中应该调用API生成Excel文件
            // 实际应用：GET /api/rankings/export
            showToast('正在导出排名表格...（演示功能）', 'info');
            console.log('导出排名数据:', AppState.rankings);
        }

        // ===================================================================
        // 【前端】管理员退出登录
        // ===================================================================
        document.getElementById('admin-logout-btn').addEventListener('click', function() {
            logout();
        });

        // ===================================================================
        // 【前端】退出登录
        // ===================================================================
        function logout() {
            AppState.currentUser = null;
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('student-dashboard').classList.add('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            
            // 清空登录表单
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
            
            showToast('已退出登录');
        }

        // ===================================================================
        // 【前端】页面加载完成后初始化
        // ===================================================================
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化模拟数据
            initMockData();
            
            // 初始化Lucide图标
            lucide.createIcons();
        });
    </script>
</body>
</html>
